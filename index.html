<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pigeons don't fit (Well they do here)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 2em;
      background-color: #eef2f3;
    }
    input[type="text"] {
      width: 80%;
      padding: 0.6em;
      font-size: 1.1em;
      margin-bottom: 1em;
    }
    button {
      padding: 0.6em 1.2em;
      margin-top: 1em;
      font-size: 1em;
      cursor: pointer;
    }
    .result {
      margin-top: 1.5em;
      font-size: 1.2em;
      font-weight: bold;
    }
    .timer {
      margin-top: 0.5em;
      font-size: 1em;
      color: #a33;
      font-weight: bold;
      display: none;
    }
    .examples {
      margin-top: 1em;
      font-size: 0.95em;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>Pigeons don't fit (Well they do here)</h1>
  <p>Enter the final coordinates:</p>
  <input type="text" id="coordsInput" placeholder="Example: N 51 12.345 W 0 12.345" />
  
  <button onclick="checkCoords()">Check</button>
  
  <div class="examples">
    Acceptable formats include:<br />
    <code>N 51 12.345 W 0 12.345</code><br />
    <code>n 51° 12.345′ w 0° 12.345′</code><br />
    <code>N51 12.345 W000 12.345</code>
  </div>

  <div class="result" id="result"></div>
  <div class="timer" id="timer"></div>

  <script>
    const MAX_ATTEMPTS = 5;
    const LOCKOUT_TIME = 10 * 60 * 1000; // 10 minutes in ms
    let timerInterval = null;

    function normalize(input) {
      return input
        .toUpperCase()
        .replace(/°|′|’|'|″|"/g, '')  // remove symbols like ° and '
        .replace(/[^A-Z0-9. ]/g, '')  // remove other non-alphanumerics
        .replace(/\s+/g, ' ')         // collapse multiple spaces
        .trim();
    }

    function getAttemptData() {
      const data = localStorage.getItem("attemptData");
      return data ? JSON.parse(data) : { count: 0, timestamp: Date.now() };
    }

    function setAttemptData(data) {
      localStorage.setItem("attemptData", JSON.stringify(data));
    }

    function startTimer(timeLeft) {
      const timerDiv = document.getElementById("timer");
      timerDiv.style.display = "block";

      function updateTimer() {
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          timerDiv.style.display = "none";
          return;
        }
        const minutes = Math.floor(timeLeft / 60000);
        const seconds = Math.floor((timeLeft % 60000) / 1000);
        timerDiv.textContent = `Please wait ${minutes}m ${seconds}s before next attempt.`;
        timeLeft -= 1000;
      }
      
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
    }

    function checkCoords() {
      const resultDiv = document.getElementById("result");
      const timerDiv = document.getElementById("timer");
      const now = Date.now();
      let data = getAttemptData();

      // Reset if more than 10 minutes have passed
      if (now - data.timestamp > LOCKOUT_TIME) {
        data = { count: 0, timestamp: now };
        setAttemptData(data);
        timerDiv.style.display = "none";
        clearInterval(timerInterval);
      }

      if (data.count >= MAX_ATTEMPTS) {
        const timeLeft = LOCKOUT_TIME - (now - data.timestamp);
        resultDiv.style.color = "red";
        resultDiv.textContent = `❌ Too many attempts. Try again later.`;
        startTimer(timeLeft);
        return;
      }

      const userInput = normalize(document.getElementById("coordsInput").value);
      const acceptableAnswers = [
        "N 52 04.082 W 0 44.708",
        "N 52 4.082 W 0 44.708",
        "N52 04.082 W000 44.708",
        "N52 4.082 W0 44.708",
        "N52 04.082 W0 44.708",
        "N 52 04.082 W000 44.708"
      ].map(normalize);

      data.count++;
      if (data.count === MAX_ATTEMPTS) {
        data.timestamp = now; // start lockout time on last allowed attempt
      }
      setAttemptData(data);

      if (acceptableAnswers.includes(userInput)) {
        resultDiv.style.color = "green";
        resultDiv.textContent = "✅ Correct! Hint: Under the boardwalk.";
        timerDiv.style.display = "none";
        clearInterval(timerInterval);
      } else {
        resultDiv.style.color = "red";
        resultDiv.textContent = `❌ Incorrect coordinates. Attempts left: ${MAX_ATTEMPTS - data.count}`;
        timerDiv.style.display = "none";
      }
    }
  </script>
</body>
</html>
